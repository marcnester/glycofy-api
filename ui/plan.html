<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Glycofy — Plan</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self'">
  <link rel="icon" href="/ui/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="/ui/styles.css" />
  <script src="/ui/app.js?v=14" defer></script>
  <script src="/ui/plan.js?v=14" defer></script>
  <style>
    .page{max-width:1200px;margin:0 auto;padding:18px}
    .top-controls{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .seg{display:inline-flex;border:1px solid #2a3a4d;border-radius:12px;overflow:hidden}
    .seg button{padding:8px 14px;background:#0f1822;border:none;color:#cfe3ff;cursor:pointer}
    .seg button.active{background:#1b2a3d}
    .card{border:1px solid #1f2a38;background:#0e141b;border-radius:14px;padding:16px}
    .muted{color:#93a5b1}
    .pill{display:inline-block;padding:8px 12px;border-radius:999px;border:1px solid #2a3a4d;background:#0f1822;color:#cfe3ff;margin-right:8px}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:980px){.row{grid-template-columns:2fr 1fr}}
    .meal{border:1px solid #203042;background:#101722;border-radius:12px;padding:12px;margin-bottom:12px}
    .meal header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .list{white-space:pre-wrap}
    .kv{display:flex;align-items:center;gap:8px}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid #2a3a4d;background:#132235;color:#d7e6ff;cursor:pointer;text-decoration:none}
    .input{background:#0f1822;border:1px solid #2a3a4d;color:#d6e6ff;padding:10px 12px;border-radius:10px}
    /* week */
    .week-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px}
    @media(max-width:1024px){.week-grid{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media(max-width:640px){.week-grid{grid-template-columns:1fr;}}
    .day-card{border:1px solid #1f2a38;background:#0e141b;border-radius:14px;padding:12px}
    .day-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .targets{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}
    .meal-sm{border:1px solid #203042;background:#101722;border-radius:10px;padding:10px;margin-top:8px}
    .meta{color:#9fb2c2;font-size:13px}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  </style>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <img src="/ui/favicon.svg" alt="G" width="18" height="18" />
    <strong>Glycofy</strong>
  </div>
  <nav class="nav-links">
    <a href="/ui/plan.html">Plan</a>
    <a href="/ui/activities.html">Activities</a>
    <a href="/ui/profile.html">Profile</a>
  </nav>
  <button id="logout_btn" class="logout-btn">Logout</button>
</header>

<main class="page">
  <div class="top-controls">
    <h1 style="margin:0">Plan</h1>
    <div class="seg" role="tablist" aria-label="View">
      <button id="tab_day" class="active" aria-selected="true">Day</button>
      <button id="tab_week" aria-selected="false">Week</button>
    </div>
  </div>

  <!-- Strava sync (lives on Plan now) -->
  <section class="card" style="margin-bottom:14px">
    <span id="strava_badge" class="pill">Strava: —</span>
    <a id="strava_connect" class="btn" href="/oauth/strava/start" style="display:none">Connect Strava</a>
    <button id="strava_sync" class="btn">Sync</button>
    <button id="strava_resync" class="btn">Full re-sync</button>
    <span id="sync_status" class="muted"></span>
  </section>

  <!-- DAY VIEW -->
  <section id="view_day" class="card" aria-labelledby="tab_day">
    <div class="controls">
      <div class="kv">
        <label for="planDate">Date</label>
        <input id="planDate" class="input" type="date" />
      </div>
      <div class="kv">
        <label for="dietSelect">Diet</label>
        <select id="dietSelect" class="input">
          <option value="omnivore">omnivore</option>
          <option value="pescatarian">pescatarian</option>
          <option value="vegan">vegan</option>
          <option value="vegetarian">vegetarian</option>
          <option value="keto">keto</option>
          <option value="none">none</option>
        </select>
      </div>
      <button id="refreshBtn" class="btn">Refresh</button>
      <button id="swapSnackBtn" class="btn" title="Swap snack">Swap snack</button>
      <button id="lockBtn" class="btn" title="Lock/unlock">Lock</button>
      <a id="gTxt" class="pill" href="#" download>Grocery .txt</a>
      <a id="gCsv" class="pill" href="#" download>Grocery .csv</a>
      <span id="status" class="muted"></span>
    </div>

    <div class="row" style="margin-top:12px">
      <section class="card">
        <h2>Meals</h2>
        <div class="muted" id="mealsEmpty" style="display:none">No meals yet. Click <b>Refresh</b>.</div>
        <div id="meals"></div>
      </section>

      <section class="card">
        <h2>Totals</h2>
        <div class="pill" id="tdeePill">TDEE: —</div>
        <div class="pill" id="trainPill">Training: —</div>
        <div class="pill" id="protPill">Protein: —</div>
        <div class="pill" id="carbPill">Carbs: —</div>
        <div class="pill" id="fatPill">Fat: —</div>
        <div class="muted" style="margin-top:10px" id="lockState"></div>
        <h3 style="margin-top:18px">Grocery list</h3>
        <div id="grocery" class="list muted"></div>
      </section>
    </div>
  </section>

  <!-- WEEK VIEW -->
  <section id="view_week" class="card" aria-labelledby="tab_week" style="display:none">
    <div class="controls">
      <div class="kv">
        <label for="week_start">Week starting (UTC)</label>
        <input id="week_start" class="input" type="date" />
      </div>
      <div class="kv">
        <label for="week_diet_pref">Diet</label>
        <select id="week_diet_pref" class="input">
          <option value="omnivore">omnivore</option>
          <option value="pescatarian">pescatarian</option>
          <option value="vegan">vegan</option>
          <option value="vegetarian">vegetarian</option>
          <option value="keto">keto</option>
        </select>
      </div>
      <button id="week_load" class="btn">Load week</button>
      <button id="week_regen" class="btn">Regenerate week</button>
      <a id="week_g_txt" class="pill" href="#" download>Export grocery (.txt)</a>
      <a id="week_g_csv" class="pill" href="#" download>Export grocery (.csv)</a>
      <span id="week_status" class="muted"></span>
    </div>

    <div id="week_grid" class="week-grid" style="margin-top:12px"></div>
  </section>
</main>
</body>
</html>